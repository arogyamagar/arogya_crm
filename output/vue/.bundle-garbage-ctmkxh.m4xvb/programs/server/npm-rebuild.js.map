{"version":3,"names":["process","env","METEOR_SKIP_NPM_REBUILD","exit","fs","require","path","spawn","rebuildArgs","get","rebuilds","e","code","binDir","dirname","execPath","PATH","delimiter","npmCmd","platform","npmCmdPath","join","existsSync","rebuild","i","dir","stdio","cwd","__dirname","on"],"sources":["/tools/static-assets/server/npm-rebuild.js"],"sourcesContent":["// If a developer wants to go to the trouble of building on exactly the\n// same architecture as the production machine, then it should be possible\n// to skip running `npm rebuild`.\nif (process.env.METEOR_SKIP_NPM_REBUILD) {\n  process.exit(0);\n}\n\nvar fs = require(\"fs\");\nvar path = require(\"path\");\nvar spawn = require(\"child_process\").spawn;\nvar rebuildArgs = require(\"./npm-rebuild-args.js\").get();\n\ntry {\n  // This JSON file gets written in meteor/tools/isobuild/bundler.js.\n  var rebuilds = require(\"./npm-rebuilds.json\");\n} catch (e) {\n  if (e.code !== \"MODULE_NOT_FOUND\") {\n    throw e;\n  }\n\n  // If npm-rebuilds.json was not written, assume there is nothing that\n  // needs to be rebuilt.\n  process.exit(0);\n}\n\n// Make sure the npm finds this exact version of node in its $PATH.\nvar binDir = path.dirname(process.execPath);\nprocess.env.PATH = binDir + path.delimiter + process.env.PATH;\n\nvar npmCmd = \"npm\";\nif (process.platform === \"win32\") {\n  var npmCmdPath = path.join(binDir, \"npm.cmd\");\n  if (fs.existsSync(npmCmdPath)) {\n    npmCmd = npmCmdPath;\n  }\n}\n\nfunction rebuild(i) {\n  var dir = rebuilds && rebuilds[i];\n\n  if (! dir) {\n    // Print Node/V8/etc. versions for diagnostic purposes.\n    spawn(npmCmd, [\"version\", \"--json\"], {\n      stdio: \"inherit\"\n    });\n\n    return;\n  }\n\n  spawn(npmCmd, rebuildArgs, {\n    cwd: path.join(__dirname, dir),\n    stdio: \"inherit\"\n  }).on(\"exit\", function (code) {\n    if (code !== 0) {\n      process.exit(code);\n    } else {\n      rebuild(i + 1);\n    }\n  });\n}\n\nrebuild(0);\n"],"mappings":"AAAA;AACA;AACA;AACA,IAAIA,OAAO,CAACC,GAAG,CAACC,uBAAuB,EAAE;EACvCF,OAAO,CAACG,IAAI,CAAC,CAAC,CAAC;AACjB;AAEA,IAAIC,EAAE,GAAGC,OAAO,CAAC,IAAI,CAAC;AACtB,IAAIC,IAAI,GAAGD,OAAO,CAAC,MAAM,CAAC;AAC1B,IAAIE,KAAK,GAAGF,OAAO,CAAC,eAAe,CAAC,CAACE,KAAK;AAC1C,IAAIC,WAAW,GAAGH,OAAO,CAAC,uBAAuB,CAAC,CAACI,GAAG,EAAE;AAExD,IAAI;EACF;EACA,IAAIC,QAAQ,GAAGL,OAAO,CAAC,qBAAqB,CAAC;AAC/C,CAAC,CAAC,OAAOM,CAAC,EAAE;EACV,IAAIA,CAAC,CAACC,IAAI,KAAK,kBAAkB,EAAE;IACjC,MAAMD,CAAC;EACT;;EAEA;EACA;EACAX,OAAO,CAACG,IAAI,CAAC,CAAC,CAAC;AACjB;;AAEA;AACA,IAAIU,MAAM,GAAGP,IAAI,CAACQ,OAAO,CAACd,OAAO,CAACe,QAAQ,CAAC;AAC3Cf,OAAO,CAACC,GAAG,CAACe,IAAI,GAAGH,MAAM,GAAGP,IAAI,CAACW,SAAS,GAAGjB,OAAO,CAACC,GAAG,CAACe,IAAI;AAE7D,IAAIE,MAAM,GAAG,KAAK;AAClB,IAAIlB,OAAO,CAACmB,QAAQ,KAAK,OAAO,EAAE;EAChC,IAAIC,UAAU,GAAGd,IAAI,CAACe,IAAI,CAACR,MAAM,EAAE,SAAS,CAAC;EAC7C,IAAIT,EAAE,CAACkB,UAAU,CAACF,UAAU,CAAC,EAAE;IAC7BF,MAAM,GAAGE,UAAU;EACrB;AACF;AAEA,SAASG,OAAO,CAACC,CAAC,EAAE;EAClB,IAAIC,GAAG,GAAGf,QAAQ,IAAIA,QAAQ,CAACc,CAAC,CAAC;EAEjC,IAAI,CAAEC,GAAG,EAAE;IACT;IACAlB,KAAK,CAACW,MAAM,EAAE,CAAC,SAAS,EAAE,QAAQ,CAAC,EAAE;MACnCQ,KAAK,EAAE;IACT,CAAC,CAAC;IAEF;EACF;EAEAnB,KAAK,CAACW,MAAM,EAAEV,WAAW,EAAE;IACzBmB,GAAG,EAAErB,IAAI,CAACe,IAAI,CAACO,SAAS,EAAEH,GAAG,CAAC;IAC9BC,KAAK,EAAE;EACT,CAAC,CAAC,CAACG,EAAE,CAAC,MAAM,EAAE,UAAUjB,IAAI,EAAE;IAC5B,IAAIA,IAAI,KAAK,CAAC,EAAE;MACdZ,OAAO,CAACG,IAAI,CAACS,IAAI,CAAC;IACpB,CAAC,MAAM;MACLW,OAAO,CAACC,CAAC,GAAG,CAAC,CAAC;IAChB;EACF,CAAC,CAAC;AACJ;AAEAD,OAAO,CAAC,CAAC,CAAC","file":"tools/static-assets/server/npm-rebuild.js.map"}