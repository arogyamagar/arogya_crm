{"version":3,"mappings":"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","names":["module","export","isWindowsLikeFilesystem","toPosixPath","convertToPosixPath","toDosPath","convertToWindowsPath","convertToOSPath","convertToStandardPath","convertToOSLineEndings","convertToStandardLineEndings","unicodeNormalizePath","wrapPathFunction","pathJoin","pathNormalize","pathRelative","pathResolve","pathDirname","pathBasename","pathExtname","pathIsAbsolute","pathSep","pathDelimiter","pathOsDelimiter","default","path","release","EOL","process","platform","toLowerCase","includes","p","partialPath","env","SystemDrive","replace","slice","test","Error","standardPath","osPath","fileContents","RegExp","normalize","f","wrapper","result","apply","Array","prototype","map","call","arguments","join","relative","resolve","dirname","basename","extname","isAbsolute","delimiter"],"sourceRoot":"","sources":["tools/static-assets/server/mini-files.ts"],"sourcesContent":["import path from \"path\";\nimport { release, EOL } from \"os\";\n\n// All of these functions are attached to files.js for the tool;\n// they live here because we need them in boot.js as well to avoid duplicating\n// a lot of the code.\n//\n// Note that this file does NOT contain any of the \"perform I/O maybe\n// synchronously\" functions from files.js; this is intentional, because we want\n// to make it very hard to accidentally use fs.*Sync functions in the app server\n// after bootup (since they block all concurrency!)\n\n// Detect that we are on a Windows-like Filesystem, such as that in a WSL\n// (Windows Subsystem for Linux) even if it otherwise looks like we're on Unix.\n// https://github.com/Microsoft/BashOnWindows/issues/423#issuecomment-221627364\nexport function isWindowsLikeFilesystem() {\n  return process.platform === \"win32\" || release().toLowerCase().includes(\"microsoft\");\n}\n\nexport function toPosixPath(p: string, partialPath: boolean = false) {\n  // Sometimes, you can have a path like \\Users\\IEUser on windows, and this\n  // actually means you want C:\\Users\\IEUser\n  if (p[0] === \"\\\\\" && (! partialPath)) {\n    p = process.env.SystemDrive + p;\n  }\n\n  p = p.replace(/\\\\/g, '/');\n  if (p[1] === ':' && ! partialPath) {\n    // transform \"C:/bla/bla\" to \"/c/bla/bla\"\n    p = '/' + p[0] + p.slice(2);\n  }\n\n  return p;\n}\n\nexport const convertToPosixPath = toPosixPath;\n\nexport function toDosPath(p: string, partialPath: boolean = false) {\n  if (p[0] === '/' && ! partialPath) {\n    if (! /^\\/[A-Za-z](\\/|$)/.test(p))\n      throw new Error(\"Surprising path: \" + p);\n    // transform a previously windows path back\n    // \"/C/something\" to \"c:/something\"\n    p = p[1] + \":\" + p.slice(2);\n  }\n\n  p = p.replace(/\\//g, '\\\\');\n  return p;\n}\n\nexport const convertToWindowsPath = toDosPath;\n\nexport function convertToOSPath(standardPath: string, partialPath: boolean = false) {\n  if (process.platform === \"win32\") {\n    return toDosPath(standardPath, partialPath);\n  }\n  return standardPath;\n}\n\nexport function convertToStandardPath(osPath: string, partialPath: boolean = false) {\n  if (process.platform === \"win32\") {\n    return toPosixPath(osPath, partialPath);\n  }\n  return osPath;\n}\n\nexport function convertToOSLineEndings(fileContents: string) {\n  return fileContents.replace(/\\n/g, EOL);\n}\n\nexport function convertToStandardLineEndings(fileContents: string) {\n  // Convert all kinds of end-of-line chars to linuxy \"\\n\".\n  return fileContents.replace(new RegExp(\"\\r\\n\", \"g\"), \"\\n\")\n                     .replace(new RegExp(\"\\r\", \"g\"), \"\\n\");\n}\n\n\n// Return the Unicode Normalization Form of the passed in path string, using\n// \"Normalization Form Canonical Composition\"\nexport function unicodeNormalizePath(path: string) {\n  return (path) ? path.normalize('NFC') : path;\n}\n\n// wrappings for path functions that always run as they were on unix (using\n// forward slashes)\nexport function wrapPathFunction<\n  TArgs extends any[],\n  TResult,\n  F extends (...args: TArgs) => TResult,\n>(\n  f: F,\n  partialPath: boolean = false,\n): F {\n  return function wrapper() {\n    if (process.platform === 'win32') {\n      const result = f.apply(path, Array.prototype.map.call(\n        arguments,\n        // if partialPaths is turned on (for path.join mostly)\n        // forget about conversion of absolute paths for Windows\n        p => toDosPath(p, partialPath),\n      ) as TArgs);\n\n      return typeof result === \"string\"\n        ? toPosixPath(result, partialPath)\n        : result;\n    }\n    return f.apply(path, arguments as any);\n  } as F;\n}\n\nexport const pathJoin = wrapPathFunction(path.join, true);\nexport const pathNormalize = wrapPathFunction(path.normalize);\nexport const pathRelative = wrapPathFunction(path.relative);\nexport const pathResolve = wrapPathFunction(path.resolve);\nexport const pathDirname = wrapPathFunction(path.dirname);\nexport const pathBasename = wrapPathFunction(path.basename);\nexport const pathExtname = wrapPathFunction(path.extname);\nexport const pathIsAbsolute = wrapPathFunction(path.isAbsolute);\nexport const pathSep = '/';\nexport const pathDelimiter = ':';\nexport const pathOsDelimiter = path.delimiter;\n"],"file":"tools/static-assets/server/mini-files.js.map"}